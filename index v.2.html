<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <title>Otaku Universe | Anime & Manga Hub</title>
    
    <meta name="description" content="The #1 Global Platform for Anime & Manga fans. News, Reviews, and Community.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <script id="aclib" type="text/javascript" src="//acscdn.com/script/aclib.js"></script>

    <style>
        /* --- Theme Variables --- */
        :root {
            --primary: #8e44ad;
            --primary-hover: #9b59b6;
            --secondary: #6c5ce7;
            --accent: #ff7675;
            --dark-bg: #09090b;
            --card-bg: #18181b;
            --text-main: #f1f2f6;
            --text-dim: #a4b0be;
            --border: 1px solid rgba(255, 255, 255, 0.1);
            --glass: rgba(24, 24, 27, 0.7);
            --glass-border: 1px solid rgba(255, 255, 255, 0.05);
            --pinned-color: #00cec9;
            --review-color: #f1c40f; 
            --gradient: linear-gradient(135deg, #8e44ad 0%, #6c5ce7 100%);
            --shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }

        body.light-mode {
            --dark-bg: #f5f6fa;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-dim: #636e72;
            --border: 1px solid rgba(0, 0, 0, 0.05);
            --glass: rgba(255, 255, 255, 0.85);
            --shadow: 0 10px 30px -10px rgba(0,0,0,0.1);
        }

        /* --- Global Styles --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', 'Cairo', sans-serif; transition: background 0.3s, color 0.3s, border 0.3s; }
        
        body { 
            background-color: var(--dark-bg); 
            color: var(--text-main); 
            overflow-x: hidden;
            min-height: 100vh;
            padding-bottom: 140px;
            font-size: 15px;
        }
        
        a { text-decoration: none; color: inherit; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--dark-bg); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 4px; }

        /* --- Navigation Bar --- */
        nav {
            background: var(--glass); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            height: 70px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; position: fixed; width: 100%; top: 0; z-index: 1000;
            border-bottom: var(--glass-border);
            box-shadow: 0 4px 30px rgba(0,0,0,0.1);
        }
        .brand { font-size: 24px; font-weight: 900; display: flex; align-items: center; gap: 10px; letter-spacing: 0.5px; }
        .brand i { color: var(--review-color); text-shadow: 0 0 15px var(--review-color); }
        .brand span { background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .nav-links { display: flex; gap: 30px; }
        .nav-link { 
            cursor: pointer; color: var(--text-dim); font-weight: 600; font-size: 14px; 
            text-transform: uppercase; letter-spacing: 1px; position: relative; padding: 5px 0;
            transition: color 0.3s;
        }
        .nav-link::after {
            content: ''; position: absolute; width: 0; height: 2px; bottom: 0; left: 0;
            background: var(--primary); transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .nav-link.active::after, .nav-link:hover::after { width: 100%; }
        .nav-link.active, .nav-link:hover { color: var(--text-main); }

        .nav-actions { display: flex; align-items: center; gap: 15px; }
        .theme-toggle { 
            font-size: 18px; cursor: pointer; color: var(--text-dim); padding: 8px; border-radius: 50%; 
            background: rgba(255,255,255,0.05); transition: 0.3s;
        }
        .theme-toggle:hover { background: var(--primary); color: white; transform: rotate(15deg); }
        
        .user-nav-box { 
            display: none; align-items: center; gap: 10px; 
            background: rgba(142, 68, 173, 0.1); padding: 6px 16px; 
            border-radius: 30px; border: 1px solid var(--primary);
        }
        .user-nav-box img { width: 34px; height: 34px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary); }
        .user-nav-box span { font-weight: 700; font-size: 13px; max-width: 100px; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }

        /* --- Layout Structure --- */
        .main-wrapper { 
            max-width: 1300px; 
            margin: 110px auto 40px; 
            padding: 0 20px; 
            display: grid; 
            grid-template-columns: 80px 1fr; 
            gap: 40px; 
        }

        .main-wrapper.full-width { grid-template-columns: 1fr; max-width: 900px; }
        
        /* Sidebar (Flags) */
        .server-rail {
            background: var(--glass); backdrop-filter: blur(10px);
            border-radius: 50px; padding: 25px 0;
            display: flex; flex-direction: column; align-items: center; gap: 20px;
            height: fit-content; position: sticky; top: 100px; border: var(--glass-border);
            z-index: 900; box-shadow: var(--shadow);
        }
        
        /* Mobile Top Bar (Flags) */
        .mobile-server-bar {
            display: none; 
            overflow-x: auto; white-space: nowrap; gap: 15px; padding: 15px 20px;
            margin-top: 70px; margin-bottom: 0;
            -webkit-overflow-scrolling: touch; scrollbar-width: none;
            background: var(--dark-bg);
        }
        .mobile-server-bar::-webkit-scrollbar { display: none; }

        .server-btn { 
            width: 50px; height: 50px; border-radius: 50%; cursor: pointer; overflow: hidden; 
            border: 3px solid transparent; flex-shrink: 0; opacity: 0.6; transform: scale(0.9);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .server-btn.active { border-color: var(--primary); opacity: 1; transform: scale(1.1); box-shadow: 0 0 20px rgba(142, 68, 173, 0.4); }
        .server-btn img { width: 100%; height: 100%; object-fit: cover; }

        /* --- HERO BANNER --- */
        .hero-banner {
            width: 100%; min-height: 280px;
            background-size: cover; background-position: center;
            border-radius: 24px; margin-bottom: 40px;
            position: relative; display: flex; align-items: flex-end;
            padding: 50px; overflow: hidden;
            box-shadow: var(--shadow);
            border: var(--border);
            transition: transform 0.5s;
        }
        .hero-banner:hover { transform: translateY(-3px); }
        .hero-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(to top, var(--card-bg), rgba(9, 9, 11, 0.2));
        }
        .hero-content { position: relative; z-index: 2; width: 100%; animation: slideUp 0.8s ease-out; }
        .hero-content h1 {
            font-size: 38px; color: white;
            text-shadow: 0 4px 20px rgba(0,0,0,0.8);
            margin-bottom: 10px; font-weight: 800; letter-spacing: -1px;
        }
        .hero-badge {
            background: var(--gradient); padding: 5px 12px; border-radius: 20px; 
            font-size: 12px; font-weight: bold; text-transform: uppercase; letter-spacing: 1px;
            margin-bottom: 15px; display: inline-block; color: white;
        }

        /* --- News & Review Section --- */
        .news-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        
        .news-card { 
            background: var(--card-bg); border-radius: 20px; overflow: hidden; border: var(--border);
            cursor: pointer; position: relative; display: flex; flex-direction: column;
            box-shadow: var(--shadow); transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
        }
        .news-card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 15px 30px rgba(142, 68, 173, 0.15); }
        
        .news-img { width: 100%; height: 200px; object-fit: cover; transition: transform 0.5s; }
        .news-card:hover .news-img { transform: scale(1.05); }
        
        .review-score-badge {
            position: absolute; top: 15px; right: 15px;
            background: rgba(0,0,0,0.8); color: var(--review-color); border: 1px solid var(--review-color);
            font-weight: 800; padding: 5px 12px; border-radius: 12px; backdrop-filter: blur(5px);
            font-size: 14px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 5;
        }

        .news-info { padding: 22px; display: flex; flex-direction: column; flex-grow: 1; }
        .news-info h3 { margin-bottom: 12px; font-size: 18px; line-height: 1.4; color: var(--text-main); font-weight: 700; }
        
        .news-meta {
            display: flex; gap: 15px; font-size: 12px;
            color: var(--secondary); margin-bottom: 10px; font-weight: 600; text-transform: uppercase;
        }
        .news-meta i { margin-right: 5px; }
        .news-info p { color: var(--text-dim); font-size: 14px; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* --- FORUM & CONTACT STYLES --- */
        #forum-section, #contact-section, #review-section { width: 100%; }
        .forum-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        
        .post-card {
            background: var(--card-bg); padding: 30px; border-radius: 20px; 
            border: var(--border); margin-bottom: 25px; cursor: pointer; width: 100%; position: relative; 
            transition: 0.3s;
        }
        .post-card.pinned { border: 1px solid var(--pinned-color); background: linear-gradient(to right, rgba(0, 206, 201, 0.05), transparent); }
        .pinned-badge { display: inline-flex; align-items: center; gap: 5px; color: var(--pinned-color); font-size: 12px; font-weight: bold; margin-bottom: 8px; }
        .post-card:hover { transform: translateX(5px); border-color: var(--primary); background: rgba(142, 68, 173, 0.03); }
        .post-card h3 { font-size: 20px; margin-bottom: 10px; color: var(--text-main); }
        .post-meta { display: flex; gap: 20px; margin-top: 15px; font-size: 13px; color: var(--text-dim); }
        .post-meta span { display: flex; align-items: center; gap: 6px; }

        .contact-container {
            max-width: 700px; margin: 0 auto; background: var(--card-bg); padding: 50px; border-radius: 24px; border: var(--border); box-shadow: var(--shadow);
        }

        /* --- Detail View --- */
        .detail-view { display: none; animation: fadeIn 0.4s ease; padding-bottom: 50px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .back-btn { 
            display: inline-flex; align-items: center; gap: 10px; 
            background: var(--card-bg); border: var(--border); padding: 10px 20px; border-radius: 30px;
            color: var(--text-main); cursor: pointer; margin-bottom: 25px; font-weight: 600; font-size: 14px;
            transition: 0.3s;
        }
        .back-btn:hover { background: var(--primary); color: white; border-color: var(--primary); transform: translateX(-5px); }
        
        .post-body { background: var(--card-bg); padding: 40px; border-radius: 24px; border: var(--border); box-shadow: var(--shadow); }
        .post-body h1 { margin-bottom: 25px; font-size: 32px; line-height: 1.3; font-weight: 800; color: var(--text-main); }
        .post-image { width: 100%; max-height: 500px; object-fit: cover; border-radius: 16px; margin-bottom: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        .video-container {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 16px; margin-bottom: 30px; background: #000; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .reactions-bar { display: flex; gap: 20px; margin: 30px 0; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 16px; align-items: center; flex-wrap: wrap; border: 1px solid rgba(255,255,255,0.05); }
        .react-btn { cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 16px; color: var(--text-dim); padding: 8px 16px; border-radius: 12px; transition: 0.2s; background: rgba(255,255,255,0.02); }
        .react-btn:hover, .react-btn.active { color: var(--accent); background: rgba(255, 62, 62, 0.15); transform: scale(1.05); }
        .thread-report-btn { margin-left: auto; color: var(--review-color); cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 5px; opacity: 0.7; }
        .thread-report-btn:hover { opacity: 1; }

        /* --- Comments --- */
        .comments-box { margin-top: 50px; border-top: 1px solid var(--border); padding-top: 40px; }
        .comment-item { 
            display: flex; gap: 20px; background: rgba(255,255,255,0.02); padding: 20px; 
            border-radius: 16px; margin-bottom: 20px; border-left: 4px solid var(--primary);
        }
        .comment-item img { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border); }
        .comment-data h4 { font-size: 15px; color: var(--secondary); margin-bottom: 6px; font-weight: 700; }
        .comment-data p { font-size: 15px; color: var(--text-main); line-height: 1.6; }

        /* --- Modals & Inputs --- */
        .modal-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 5000; padding: 20px;
        }
        .modal-content { 
            background: var(--card-bg); width: 100%; max-width: 450px; padding: 40px; 
            border-radius: 24px; border: 1px solid var(--primary); position: relative; text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6); animation: zoomIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .input-group { margin-bottom: 20px; text-align: left; }
        .input-group label { display: block; font-size: 13px; color: var(--text-dim); margin-bottom: 8px; font-weight: 600; letter-spacing: 0.5px; }
        .input-group input, .input-group textarea, .input-group select { 
            width: 100%; padding: 14px 18px; background: rgba(255,255,255,0.03); 
            border: 1px solid var(--border); border-radius: 12px; color: white; outline: none; font-size: 15px;
            transition: 0.3s;
        }
        .input-group input:focus, .input-group textarea:focus { border-color: var(--primary); background: rgba(255,255,255,0.08); box-shadow: 0 0 15px rgba(142, 68, 173, 0.2); }
        
        .main-btn { 
            width: 100%; padding: 14px; background: var(--gradient); color: white; 
            border: none; border-radius: 12px; font-weight: 700; cursor: pointer; font-size: 16px;
            box-shadow: 0 5px 20px rgba(142, 68, 173, 0.3); transition: 0.3s; position: relative; overflow: hidden;
        }
        .main-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(142, 68, 173, 0.5); }
        .main-btn::after { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); transition: 0.5s; }
        .main-btn:hover::after { left: 100%; }

        /* --- Mobile Bottom Navigation --- */
        .mobile-nav {
            display: none; position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--glass); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-top: var(--glass-border);
            justify-content: space-around; padding: 12px 0; z-index: 4000;
            padding-bottom: 20px;
        }
        .mobile-nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            color: var(--text-dim); font-size: 10px; cursor: pointer; padding: 5px 15px; border-radius: 15px;
            transition: 0.3s;
        }
        .mobile-nav-item i { font-size: 20px; margin-bottom: 2px; transition: 0.3s; }
        .mobile-nav-item.active { color: var(--primary); background: rgba(142, 68, 173, 0.1); }
        .mobile-nav-item.active i { transform: translateY(-2px); }

        /* --- ADVERTISING STYLES --- */
        .ad-wrapper {
            position: fixed; bottom: 70px; left: 0; width: 100%;
            display: flex; justify-content: center; align-items: center;
            background: var(--dark-bg); z-index: 3900;
            padding: 8px 0; border-top: 1px solid var(--border);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }

        @media (min-width: 769px) {
            .ad-wrapper { bottom: 0; padding: 15px 0; height: 110px; }
            body { padding-bottom: 130px; }
        }

        /* --- MOBILE STYLES (UPDATED FOR BETTER LAYOUT) --- */
        @media (max-width: 768px) {
            /* 1. ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿ¥ÿπÿßÿ± ŸàÿßŸÑŸÜÿµ */
            .brand { 
                font-size: 18px !important; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿÆÿ∑ ŸÖŸÜ 24 ÿßŸÑŸâ 18 */
                gap: 5px !important; 
            }
            .brand i { font-size: 18px !important; }

            /* 2. ÿ™ÿµÿ∫Ÿäÿ± ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ ŸàÿßŸÑÿµŸàÿ±ÿ© */
            .user-nav-box {
                padding: 4px 8px !important; /* ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿØÿßÿÆŸÑŸäÿ© */
                gap: 6px !important;
                height: 36px;
                margin-right: 2px;
            }
            
            .user-nav-box img {
                width: 24px !important; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßŸÑÿµŸàÿ±ÿ© */
                height: 24px !important;
                border-width: 1px !important;
            }

            .user-nav-box span {
                font-size: 11px !important; /* ÿ™ÿµÿ∫Ÿäÿ± ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ */
                max-width: 60px; /* ŸÖŸÜÿπ ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑÿ∑ŸàŸäŸÑ ŸÖŸÜ ÿ™ÿÆÿ±Ÿäÿ® ÿßŸÑÿ¥ŸÉŸÑ */
            }

            /* ÿ™ÿµÿ∫Ÿäÿ± ÿ≤ÿ± ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ */
            #login-trigger {
                padding: 6px 14px !important;
                font-size: 12px !important;
            }

            /* 3. ÿ∂ÿ®ÿ∑ ÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™ ÿßŸÑÿπÿßŸÖÿ© ŸÅŸä ÿßŸÑÿ¥ÿ±Ÿäÿ∑ */
            nav {
                padding: 0 15px !important; /* ŸÖÿ≥ÿßŸÅÿ© ŸÖŸÜ ÿßŸÑŸäŸÖŸäŸÜ ŸàÿßŸÑŸäÿ≥ÿßÿ± */
                height: 60px !important; /* ÿ™ŸÇŸÑŸäŸÑ ÿßÿ±ÿ™ŸÅÿßÿπ ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ŸÇŸÑŸäŸÑÿßŸã */
            }

            .nav-actions {
                gap: 10px !important; /* ÿ™ŸÇŸÑŸäŸÑ ÿßŸÑŸÅÿ±ÿßÿ∫ ÿ®ŸäŸÜ ÿßŸÑÿπŸÜÿßÿµÿ± */
            }
            
            .theme-toggle {
                font-size: 16px !important;
                padding: 5px !important;
            }
            
            /* ÿ•ÿÆŸÅÿßÿ° ÿßŸÑŸÇŸàÿßÿ¶ŸÖ Ÿàÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑÿ≥Ÿäÿ±ŸÅÿ±ÿßÿ™ ŸÉŸÖÿß ŸÉÿßŸÜ ÿ≥ÿßÿ®ŸÇÿßŸã */
            .nav-links { display: none; }
            .server-rail { display: none !important; } 
            .mobile-nav { display: flex; }
            .mobile-server-bar { display: flex; }
            .ad-wrapper { bottom: 75px; height: 60px; padding: 5px 0; }

            .main-wrapper { 
                display: block; margin-top: 20px; margin-bottom: 20px; 
                padding: 0 15px; width: 100%;
            }
            
            .news-grid { grid-template-columns: 1fr; gap: 20px; }
            .post-body { padding: 25px; }
            .post-body h1 { font-size: 24px; }
            
            .forum-header { flex-direction: column; align-items: stretch; gap: 15px; }
            .post-card { padding: 20px; }

            .hero-banner { min-height: 200px; padding: 25px; margin-bottom: 30px; }
            .hero-content h1 { font-size: 26px; }

            body { padding-bottom: 150px; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="brand"><i class="fas fa-bolt"></i> OTAKU<span>UNIVERSE</span></div>
        <div class="nav-links">
            <div class="nav-link active" onclick="switchTab('news')">News</div>
            <div class="nav-link" onclick="switchTab('review')">Reviews</div> 
            <div class="nav-link" onclick="switchTab('forum')">Community</div>
            <div class="nav-link" onclick="switchTab('contact')">Contact</div>
        </div>
        <div class="nav-actions">
            <div class="theme-toggle" onclick="toggleTheme()"><i class="fas fa-moon" id="t-icon"></i></div>
            <button id="login-trigger" class="main-btn" style="width:auto; padding:8px 24px; font-size:13px; border-radius:30px;" onclick="openModal('login-modal')">Login</button>
            <div id="user-display" class="user-nav-box">
                <img id="nav-avatar" src="">
                <span id="nav-username"></span>
                <i class="fas fa-sign-out-alt" onclick="executeLogout()" style="margin-left:5px; cursor:pointer; color:var(--accent); font-size:14px;" title="Logout"></i>
            </div>
        </div>
    </nav>

    <div class="mobile-server-bar" id="mobile-rail-id">
        <div class="server-btn active" onclick="switchServer('us', this)"><img src="https://flagcdn.com/w80/us.png"></div>
        <div class="server-btn" onclick="switchServer('sa', this)"><img src="https://flagcdn.com/w80/sa.png"></div>
        <div class="server-btn" onclick="switchServer('jp', this)"><img src="https://flagcdn.com/w80/jp.png"></div>
        <div class="server-btn" onclick="switchServer('es', this)"><img src="https://flagcdn.com/w80/es.png"></div>
    </div>

    <div class="main-wrapper" id="main-wrapper-id">
        <aside class="server-rail" id="desktop-rail-id">
            <div class="server-btn active" onclick="switchServer('us', this)"><img src="https://flagcdn.com/w80/us.png"></div>
            <div class="server-btn" onclick="switchServer('sa', this)"><img src="https://flagcdn.com/w80/sa.png"></div>
            <div class="server-btn" onclick="switchServer('jp', this)"><img src="https://flagcdn.com/w80/jp.png"></div>
            <div class="server-btn" onclick="switchServer('es', this)"><img src="https://flagcdn.com/w80/es.png"></div>
        </aside>

        <main id="main-content-area">
            
            <div class="hero-banner" id="hero-banner" style="background-image: url('https://i.postimg.cc/kGFSkxcQ/IMG-20260201-164320.jpg');">
                <div class="hero-overlay"></div>
                <div class="hero-content">
                    <span class="hero-badge">Featured News</span>
                    <h1 id="hero-text">Welcome to Otaku Universe</h1>
                </div>
            </div>

            <div id="interface-us" class="server-view-container tab-content">
                <h2 style="margin-bottom: 25px; display:flex; align-items:center; gap:12px; font-size: 22px;">
                    <img src="https://flagcdn.com/w40/us.png" width="28" style="border-radius:4px"> Global Headlines
                </h2>
                <div id="news-container-us" class="news-grid"></div>
                <div id="news-reader-us" class="detail-view">
                    <div class="back-btn" onclick="goBackToGrid()"><i class="fas fa-arrow-left"></i> Back to Feed</div>
                    <div class="post-body" id="reader-body-us"></div>
                </div>
            </div>

            <div id="interface-sa" class="server-view-container tab-content" style="display:none">
                <h2 style="margin-bottom: 25px; display:flex; align-items:center; gap:12px; font-family:'Cairo'; font-size: 22px;">
                    <img src="https://flagcdn.com/w40/sa.png" width="28" style="border-radius:4px"> ÿ£ÿÆÿ®ÿßÿ± ÿßŸÑÿ£ŸÜŸÖŸä
                </h2>
                <div id="news-container-sa" class="news-grid" style="direction: rtl;"></div>
                <div id="news-reader-sa" class="detail-view" style="text-align:right; direction: rtl;">
                    <div class="back-btn" onclick="goBackToGrid()"><i class="fas fa-arrow-right"></i> ÿßŸÑÿ±ÿ¨Ÿàÿπ ŸÑŸÑÿ£ÿÆÿ®ÿßÿ±</div>
                    <div class="post-body" id="reader-body-sa"></div>
                </div>
            </div>

            <div id="interface-jp" class="server-view-container tab-content" style="display:none">
                 <h2 style="margin-bottom: 25px; display:flex; align-items:center; gap:12px; font-size: 22px;">
                    <img src="https://flagcdn.com/w40/jp.png" width="28" style="border-radius:4px"> Japan News
                </h2>
                <div id="news-container-jp" class="news-grid"></div>
                <div id="news-reader-jp" class="detail-view">
                    <div class="back-btn" onclick="goBackToGrid()"><i class="fas fa-arrow-left"></i> Back</div>
                    <div class="post-body" id="reader-body-jp"></div>
                </div>
            </div>

            <div id="interface-es" class="server-view-container tab-content" style="display:none">
                 <h2 style="margin-bottom: 25px; display:flex; align-items:center; gap:12px; font-size: 22px;">
                    <img src="https://flagcdn.com/w40/es.png" width="28" style="border-radius:4px"> Noticias Anime
                </h2>
                <div id="news-container-es" class="news-grid"></div>
                <div id="news-reader-es" class="detail-view">
                    <div class="back-btn" onclick="goBackToGrid()"><i class="fas fa-arrow-left"></i> Volver</div>
                    <div class="post-body" id="reader-body-es"></div>
                </div>
            </div>

            <section id="review-section" class="tab-content" style="display:none">
                 <div class="forum-header">
                    <h2><i class="fas fa-star" style="color:var(--review-color)"></i> Anime Reviews (<span id="review-server-label">US</span>)</h2>
                </div>
                <div id="review-grid" class="news-grid"></div>
                <div id="review-reader" class="detail-view">
                    <div class="back-btn" onclick="goBackToGrid()"><i class="fas fa-arrow-left"></i> Back to Reviews</div>
                    <div class="post-body" id="review-body"></div>
                </div>
            </section>

            <section id="forum-section" class="tab-content" style="display:none">
                <div id="forum-main-ui">
                    <div class="forum-header">
                        <h2><i class="fas fa-users" style="color:var(--primary)"></i> Community (<span id="community-server-label">US</span>)</h2>
                        <button class="main-btn" style="width:auto; padding:10px 20px" onclick="openModal('create-post-modal')"><i class="fas fa-plus"></i> New Post</button>
                    </div>
                    <div id="forum-feed"></div>
                </div>

                <div id="forum-detail-ui" class="detail-view">
                    <div class="back-btn" onclick="closeThread()"><i class="fas fa-arrow-left"></i> Back to Community</div>
                    <div id="thread-content" class="post-body"></div>
                    
                    <div class="reactions-bar">
                        <div class="react-btn" onclick="updateReaction('like')" id="btn-like"><i class="fas fa-heart"></i> <span id="like-total">0</span></div>
                        
                        <div class="thread-report-btn" onclick="reportCurrentThread()">
                            <i class="fas fa-exclamation-triangle"></i> <span id="lbl-report-txt">Report</span>
                        </div>
                    </div>

                    <div class="comments-box">
                        <h3><i class="fas fa-comments"></i> Discussion</h3>
                        <div id="comments-render" style="margin-top: 25px;"></div>
                        <div class="input-group" style="margin-top:30px">
                            <textarea id="comment-text" placeholder="Share your thoughts..." rows="3"></textarea>
                            <button class="main-btn" style="margin-top:15px; width:auto;" onclick="postComment()">Post Comment</button>
                        </div>
                    </div>
                </div>
            </section>

            <section id="contact-section" class="tab-content" style="display:none; position: relative;">
                <div class="contact-container">
                    <h1 style="text-align: center; margin-bottom: 20px; color:var(--primary); font-size:30px"><i class="fas fa-headset"></i> Contact Support</h1>
                    <p style="color:var(--text-dim); margin-bottom:40px; text-align: center;">Have a suggestion or found a bug? We are here to help.</p>
                    
                    <div class="input-group"><label>Name</label><input type="text" id="c-name" placeholder="Your Name"></div>
                    <div class="input-group"><label>Email</label><input type="email" id="c-email" placeholder="Your Email"></div>
                    <div class="input-group"><label>Message</label><textarea id="c-msg" placeholder="Your Message" rows="5"></textarea></div>
                    <button class="main-btn" onclick="sendContactMail()">Send Message</button>
                </div>
            </section>

        </main>
    </div>

    <div class="ad-wrapper">
        <div style="background: white; padding: 2px; border-radius: 4px;">
            <script type="text/javascript">
                aclib.runBanner({
                    zoneId: '10864598',
                });
            </script>
        </div>
    </div>

    <div class="mobile-nav">
        <div class="mobile-nav-item active" onclick="switchTab('news'); updateMobileNav(this)">
            <i class="fas fa-newspaper"></i>
            <span>News</span>
        </div>
         <div class="mobile-nav-item" onclick="switchTab('review'); updateMobileNav(this)">
            <i class="fas fa-star"></i>
            <span>Reviews</span>
        </div>
        <div class="mobile-nav-item" onclick="switchTab('forum'); updateMobileNav(this)">
            <i class="fas fa-comments"></i>
            <span>Forum</span>
        </div>
        <div class="mobile-nav-item" onclick="switchTab('contact'); updateMobileNav(this)">
            <i class="fas fa-envelope"></i>
            <span>Contact</span>
        </div>
    </div>

    <div class="modal-overlay" id="login-modal">
        <div class="modal-content">
            <i class="fas fa-times" style="position:absolute; top:20px; right:25px; cursor:pointer; font-size:20px;" onclick="closeAllModals()"></i>
            <h2>Welcome Back</h2>
            <div class="input-group" style="margin-top:30px">
                <label>Email Address</label>
                <input type="email" id="log-email" placeholder="name@example.com">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="log-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>
            <button class="main-btn" onclick="executeLogin()">Login Account</button>
            <p style="margin-top:25px; font-size:14px; color:var(--text-dim)">
                Don't have an account? <span onclick="openModal('reg-modal')" style="color:var(--primary); cursor:pointer; font-weight:700">Register Now</span>
            </p>
        </div>
    </div>

    <div class="modal-overlay" id="reg-modal">
        <div class="modal-content">
            <i class="fas fa-times" style="position:absolute; top:20px; right:25px; cursor:pointer; font-size:20px;" onclick="closeAllModals()"></i>
            <h2>Join Community</h2>
            <div style="width: 110px; height: 110px; border-radius: 50%; background: #000; margin: 20px auto; display: flex; align-items: center; justify-content: center; border: 2px dashed var(--primary); cursor: pointer; overflow: hidden; position: relative;" onclick="document.getElementById('avatar-input').click()">
                <img id="avatar-preview" src="" style="width:100%; height:100%; object-fit:cover; display:none">
                <i class="fas fa-camera" id="avatar-icon" style="color:var(--primary); font-size:28px"></i>
            </div>
            <input type="file" id="avatar-input" hidden accept="image/*" onchange="processAvatar(this)">
            
            <div class="input-group"><input type="text" id="reg-name" placeholder="Username"></div>
            <div class="input-group"><input type="email" id="reg-email" placeholder="Email Address"></div>
            <div class="input-group"><input type="password" id="reg-pass" placeholder="Password"></div>
            <button class="main-btn" onclick="executeRegister()">Create Account</button>
        </div>
    </div>

    <div class="modal-overlay" id="create-post-modal">
        <div class="modal-content">
            <i class="fas fa-times" style="position:absolute; top:20px; right:25px; cursor:pointer" onclick="closeAllModals()"></i>
            <h2>Create Discussion</h2>
            <div class="input-group" style="margin-top:20px"><label>Title</label><input type="text" id="p-title" placeholder="What's on your mind?"></div>
            <div class="input-group"><label>Image URL (Optional)</label><input type="text" id="p-img-url" placeholder="https://..."></div>
            <div class="input-group"><label>Content</label><textarea id="p-desc" rows="5" placeholder="Write something..."></textarea></div>
            <button class="main-btn" onclick="saveThread()">Post Thread</button>
        </div>
    </div>

    <div class="modal-overlay" id="report-modal">
        <div class="modal-content">
            <i class="fas fa-times" style="position:absolute; top:20px; right:25px; cursor:pointer" onclick="closeAllModals()"></i>
            <h3 id="report-title-lbl">Report Content</h3>
            <div class="input-group" style="margin-top:25px">
                <label id="report-reason-lbl">Reason</label>
                <select id="report-reason">
                    <option value="Spam">Spam / ÿ•ÿ≤ÿπÿßÿ¨</option>
                    <option value="Inappropriate">Inappropriate / ÿ∫Ÿäÿ± ŸÑÿßÿ¶ŸÇ</option>
                    <option value="Spoiler">Spoiler / ÿ≠ÿ±ŸÇ</option>
                </select>
            </div>
            <input type="hidden" id="report-target-user"><input type="hidden" id="report-target-text">
            <button id="report-submit-btn" class="main-btn" style="background:var(--review-color); color:black" onclick="submitReport()">Submit Report</button>
        </div>
    </div>

    <script>
        /* --- CONFIGURATION --- */
        const firebaseConfig = {
            apiKey: "AIzaSyD6YYVOkPI1TJEExWMXcAdUabCENXx5gYY",
            databaseURL: "https://news-server-fff75-default-rtdb.firebaseio.com",
            projectId: "news-server-fff75",
            storageBucket: "news-server-fff75.firebasestorage.app",
            messagingSenderId: "420540242806",
            appId: "1:420540242806:web:0fa1e10f18fe57b64e7857",
            measurementId: "G-TWV84KPXDL"
        };
        
        const TG_TOKEN = "8584369176:AAF7_akcyjXyic2MG7cd1Xx4JgB2uOpJ7ok";
        const TG_CHANNEL_ID = "-1003650299197";

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        /* --- STATE --- */
        let currentUser = null;
        let currentServer = 'us'; 

        // ==========================================
        //  (1) ŸÖŸÜÿ∑ŸÇÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿ£ÿÆÿ®ÿßÿ± - NEWS AREA
        // ==========================================
        let newsData = [
        
    {
    id: "5",
    server: "jp",
    title: "„ÄéWistoria: Wand and Sword„ÄèÊº´Áîª„ÄÅÁ¥ØË®àÁô∫Ë°åÈÉ®Êï∞300‰∏áÈÉ®Á™ÅÁ†¥„ÅßÂÖ®Â∑ªÈáçÁâàÊ±∫ÂÆö",
    img: "https://i.postimg.cc/gkJnKFh6/1769950619-f9ee68407331b3e9b3b0fb9d0796dfcc-768x432.png",
    videoUrl: "",
    desc: "Êº´Áîª„ÄéWistoria: Wand and Sword„Äè„ÅØ„ÄÅÁ¥ØË®àÁô∫Ë°åÈÉ®Êï∞„Åå300‰∏áÈÉ®„ÇíÁ™ÅÁ†¥„Åó„Åü„Åì„Å®„ÇíÂèó„Åë„ÄÅÂÖ®Â∑ªÈáçÁâà„ÅåÊ≠£Âºè„Å´Áô∫Ë°®„Åï„Çå„Åü„ÄÇÊú¨‰Ωú„ÅÆ‰∫∫Ê∞ó„ÅØÁùÄÂÆü„Å´Êã°Â§ß„Åó„Å¶„Åä„Çä„ÄÅÊ¨°Â∑ª„ÅØ2026Âπ¥4Êúà„Å´Áô∫Â£≤‰∫àÂÆö„ÄÇ„Åæ„Åü„ÄÅÂêåÊôÇÊúü„Å´„ÉÜ„É¨„Éì„Ç¢„Éã„É°Á¨¨2Êúü„ÅÆÊîæÈÄÅÈñãÂßã„ÇÇ‰∫àÂÆö„Åï„Çå„Å¶„ÅÑ„Çã„ÄÇ",
    date: "2026-04-01",
    author: "Admin"
},
        {
    id: "4",
    server: "sa",
    title: "ŸÖÿßŸÜÿ∫ÿß Wistoria: Wand and Sword ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ•ÿπÿßÿØÿ© ÿ∑ÿ®ÿßÿπÿ© ŸÉÿßŸÖŸÑÿ© ÿ®ÿπÿØ ÿ™ÿ¨ÿßŸàÿ≤ ÿßŸÑÿ™Ÿàÿ≤Ÿäÿπ 3 ŸÖŸÑÿßŸäŸäŸÜ ŸÜÿ≥ÿÆÿ©",
    img: "https://i.postimg.cc/gkJnKFh6/1769950619-f9ee68407331b3e9b3b0fb9d0796dfcc-768x432.png",
    videoUrl: "",
    desc: "ÿ£ÿπŸÑŸÜÿ™ ŸÖÿßŸÜÿ∫ÿß Wistoria: Wand and Sword ÿ±ÿ≥ŸÖŸäŸãÿß ÿπŸÜ ÿ•ÿπÿßÿØÿ© ÿ∑ÿ®ÿßÿπÿ© ŸÉÿßŸÖŸÑÿ© ŸÑÿ¨ŸÖŸäÿπ ÿ£ÿ¨ÿ≤ÿßÿ¶Ÿáÿßÿå ÿ®ÿπÿØ ÿ£ŸÜ ÿ™ÿ¨ÿßŸàÿ≤ ÿ•ÿ¨ŸÖÿßŸÑŸä ÿπÿØÿØ ÿßŸÑŸÜÿ≥ÿÆ ÿßŸÑŸÖÿ™ÿØÿßŸàŸÑÿ© 3 ŸÖŸÑÿßŸäŸäŸÜ ŸÜÿ≥ÿÆÿ©. ŸäÿπŸÉÿ≥ Ÿáÿ∞ÿß ÿßŸÑÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑÿ¥ÿπÿ®Ÿäÿ© ÿßŸÑŸÖÿ™ÿ≤ÿßŸäÿØÿ© ŸÑŸÑÿ≥ŸÑÿ≥ŸÑÿ©. ŸàŸÖŸÜ ÿßŸÑŸÖŸÇÿ±ÿ± ÿ•ÿµÿØÿßÿ± ÿßŸÑŸÖÿ¨ŸÑÿØ ÿßŸÑŸÇÿßÿØŸÖ ŸÅŸä ÿ£ÿ®ÿ±ŸäŸÑ 2026ÿå ÿ®ÿßŸÑÿ™ÿ≤ÿßŸÖŸÜ ŸÖÿπ ÿπÿ±ÿ∂ ÿßŸÑŸÖŸàÿ≥ŸÖ ÿßŸÑÿ´ÿßŸÜŸä ŸÖŸÜ ÿßŸÑÿ£ŸÜŸÖŸä.",
    date: "2026-04-01",
    author: "Admin"
},
        {
    id: "3",
    server: "es",
    title: "El manga Wistoria: Wand and Sword recibe una reimpresi√≥n completa al superar los 3 millones de copias",
    img: "https://i.postimg.cc/gkJnKFh6/1769950619-f9ee68407331b3e9b3b0fb9d0796dfcc-768x432.png",
    videoUrl: "",
    desc: "El manga Wistoria: Wand and Sword ha anunciado una reimpresi√≥n completa de la serie tras superar los 3 millones de copias en circulaci√≥n. Este logro confirma la creciente popularidad de la franquicia. El pr√≥ximo volumen del manga se lanzar√° en abril de 2026, coincidiendo con el estreno de la segunda temporada del anime.",
    date: "2026-04-01",
    author: "Admin"
},
            {
    id: "2",
    server: "us",
    title: "Wistoria: Wand and Sword Manga Gets Full-Series Reprint as Circulation Surpasses 3 Million",
    img: "https://i.postimg.cc/gkJnKFh6/1769950619-f9ee68407331b3e9b3b0fb9d0796dfcc-768x432.png",
    videoUrl: "",
    desc: "The manga Wistoria: Wand and Sword has announced a full-series reprint after its total circulation exceeded 3 million copies. This milestone highlights the growing popularity of the series. A new manga volume is set to release in April 2026, coinciding with the premiere of Season 2 of the TV anime.",
    date: "2026-04-01",
    author: "Admin"
}
 
            // >>> ÿ£ÿ∂ŸÅ ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ© ŸáŸÜÿß (Add New News Here)
        ];

        // ==========================================
        //  (2) ŸÖŸÜÿ∑ŸÇÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿßÿ™ - REVIEWS AREA
        // ==========================================
        let reviewsData = [
            {
                id: "101",
                server: "us", 
                title: "Attack on Titan Final Season Review",
                img: "https://images7.alphacoders.com/133/1330715.jpeg",
                desc: "An absolute masterpiece regarding storytelling and animation. The conclusion is...",
                score: "10" 
            },
            {
                id: "102",
                server: "sa", 
                title: "ŸÖÿ±ÿßÿ¨ÿπÿ© ÿßŸÜŸÖŸä ÿ¨Ÿàÿ¨Ÿàÿ™ÿ≥Ÿà ŸÉÿßŸäÿ≥ŸÜ",
                img: "https://images.alphacoders.com/114/1146237.jpg",
                desc: "ÿßŸÑÿ£ŸÜŸÖŸä ŸäŸÇÿØŸÖ ŸÖÿ≥ÿ™ŸàŸâ ÿ™ÿ≠ÿ±ŸäŸÉ ÿÆÿ±ÿßŸÅŸä ŸàŸÇÿµÿ© ŸÖÿ¥ŸàŸÇÿ© ÿ¨ÿØÿßŸãÿå ÿßŸÑÿ¥ÿÆÿµŸäÿßÿ™ ŸÖŸÉÿ™Ÿàÿ®ÿ© ÿ®ÿπŸÜÿßŸäÿ©...",
                score: "9.5" 
            }
            // >>> ÿ£ÿ∂ŸÅ ÿßŸÑŸÖÿ±ÿßÿ¨ÿπÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ© ŸáŸÜÿß (Add New Reviews Here)
        ];
        
        let threads = [];
        let activeThread = null;
        let activeThreadDocId = null;

        /* --- LOGIC --- */
        function initRealtimeListeners() {
            renderNews();
            renderReviews();
            db.collection('threads').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                threads = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderForum();
                if(activeThreadDocId) {
                    const updated = threads.find(t => t.id === activeThreadDocId);
                    if(updated) { activeThread = updated; renderComments(); updateReactionUI(); }
                }
            });
        }

        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = { 
                    name: user.displayName || "User", email: user.email,
                    avatar: user.photoURL || "https://via.placeholder.com/100" 
                };
                updateUserUI();
            } else {
                currentUser = null;
                document.getElementById('login-trigger').style.display = 'block';
                document.getElementById('user-display').style.display = 'none';
            }
        });

        /* --- Routing (SEO Friendly ?type=news&id=1) --- */
        function createSlug(title) { return title.toLowerCase().replace(/ /g, '-').replace(/[^\w-]+/g, ''); }

        function handleRouting() {
            // ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑÿ®ÿßÿ±ÿßŸÖÿ™ÿ±ÿßÿ™ ŸÖŸÜ ÿßŸÑÿ±ÿßÿ®ÿ∑
            const urlParams = new URLSearchParams(window.location.search);
            const type = urlParams.get('type');
            const id = urlParams.get('id');

            if (type === 'news' && id) {
                const item = newsData.find(n => n.id === id);
                if (item) {
                    // Update Title for Browser
                    document.title = `${item.title} | Otaku Universe`;
                    switchTab('news');
                    if(item.server !== currentServer) {
                        switchServer(item.server, document.querySelector(`.server-btn[onclick*="${item.server}"]`));
                    }
                    renderNewsDetail(item);
                }
            } else if (type === 'review' && id) {
                const item = reviewsData.find(r => r.id === id);
                if (item) {
                    document.title = `${item.title} | Review`;
                    switchTab('review');
                    if(item.server !== currentServer) {
                        switchServer(item.server, document.querySelector(`.server-btn[onclick*="${item.server}"]`));
                    }
                    renderReviewDetail(item);
                }
            } else {
                // Default Title
                document.title = "Otaku Universe | Anime & Manga Hub";
                closeNewsReader(); 
                closeReviewReader();
            }
        }
        
        // Listen to Back/Forward buttons
        window.addEventListener('popstate', handleRouting);
        window.addEventListener('load', () => { initRealtimeListeners(); handleRouting(); });

        function goBackToGrid() {
            // ŸÖÿ≥ÿ≠ ÿßŸÑÿ®ÿßÿ±ÿßŸÖÿ™ÿ±ÿßÿ™ ŸÖŸÜ ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸàÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
            window.history.pushState({}, "Otaku Universe", window.location.pathname);
            document.title = "Otaku Universe | Anime & Manga Hub";
            closeNewsReader(); 
            closeReviewReader();
        }

        /* --- UI Functions --- */
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

            const rail = document.getElementById('desktop-rail-id');
            const mobileRail = document.getElementById('mobile-rail-id');
            const wrapper = document.getElementById('main-wrapper-id');

            if (tabId === 'news') {
                document.getElementById('interface-' + currentServer).style.display = 'block';
                document.querySelectorAll('.nav-link')[0].classList.add('active');
                if(rail) rail.style.display = 'flex'; 
                if(mobileRail) mobileRail.style.display = (window.innerWidth <= 768) ? 'flex' : 'none';
                wrapper.classList.remove('full-width');
                document.getElementById('hero-banner').style.display = 'flex';

            } else if (tabId === 'review') {
                document.getElementById('review-section').style.display = 'block';
                document.querySelectorAll('.nav-link')[1].classList.add('active');
                if(rail) rail.style.display = 'flex';
                if(mobileRail) mobileRail.style.display = (window.innerWidth <= 768) ? 'flex' : 'none';
                wrapper.classList.remove('full-width');
                document.getElementById('hero-banner').style.display = 'none';
                renderReviews();

            } else if (tabId === 'forum') {
                document.getElementById('forum-section').style.display = 'block';
                document.querySelectorAll('.nav-link')[2].classList.add('active');
                if(rail) rail.style.display = 'flex';
                if(mobileRail) mobileRail.style.display = (window.innerWidth <= 768) ? 'flex' : 'none';
                wrapper.classList.remove('full-width');
                document.getElementById('hero-banner').style.display = 'none';
                renderForum();

            } else if (tabId === 'contact') {
                document.getElementById('contact-section').style.display = 'block';
                document.querySelectorAll('.nav-link')[3].classList.add('active');
                if(rail) rail.style.display = 'none';
                if(mobileRail) mobileRail.style.display = 'none';
                wrapper.classList.add('full-width');
                document.getElementById('hero-banner').style.display = 'none';
            }
        }
        
        function updateMobileNav(element) {
            document.querySelectorAll('.mobile-nav-item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');
        }

        function switchServer(serverId, btn) {
            document.querySelectorAll('.server-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            else document.querySelectorAll(`.server-btn[onclick*="${serverId}"]`).forEach(b => b.classList.add('active'));
            
            currentServer = serverId;
            
            if(document.getElementById('forum-section').style.display !== 'none') renderForum();
            else if (document.getElementById('review-section').style.display !== 'none') renderReviews();
            else { switchTab('news'); renderNews(); }
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const icon = document.getElementById('t-icon');
            icon.className = document.body.classList.contains('light-mode') ? 'fas fa-sun' : 'fas fa-moon';
        }

        /* --- Auth Functions --- */
        function processAvatar(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = e => {
                    document.getElementById('avatar-preview').src = e.target.result;
                    document.getElementById('avatar-preview').style.display = 'block';
                    document.getElementById('avatar-icon').style.display = 'none';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        function executeRegister() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            const pfp = document.getElementById('avatar-preview').src;
            
            if(!name || !email || !pass) return alert("Please fill all fields!");
            if(pfp.includes("window.location") || pfp === "") return alert("Please select an avatar!");

            auth.createUserWithEmailAndPassword(email, pass)
                .then((userCredential) => {
                    userCredential.user.updateProfile({ displayName: name, photoURL: pfp }).then(() => {
                        currentUser = { name: name, email: email, avatar: pfp };
                        sendTextToTelegram(`üÜï New User:\nüë§ Name: ${name}\nüìß Email: ${email}`);
                        updateUserUI(); closeAllModals();
                    });
                })
                .catch((error) => { alert("Error: " + error.message); });
        }

        function executeLogin() {
            const email = document.getElementById('log-email').value;
            const pass = document.getElementById('log-pass').value;
            if(!email || !pass) return alert("Please enter email and password");

            auth.signInWithEmailAndPassword(email, pass)
                .then(() => { closeAllModals(); })
                .catch((error) => { alert("Login Failed: " + error.message); });
        }

        function executeLogout() { auth.signOut().then(() => { window.location.reload(); }); }

        function updateUserUI() {
            if(currentUser) {
                document.getElementById('login-trigger').style.display = 'none';
                document.getElementById('user-display').style.display = 'flex';
                document.getElementById('nav-username').innerText = currentUser.name;
                document.getElementById('nav-avatar').src = currentUser.avatar;
            }
        }

        function sendContactMail() {
            const name = document.getElementById('c-name').value;
            const email = document.getElementById('c-email').value;
            const msg = document.getElementById('c-msg').value;
            if(!name || !email || !msg) { alert("Please fill in all fields"); return; }
            sendTextToTelegram(`üì© Contact Msg:\n\nüë§ From: ${name}\nüìß Email: ${email}\nüìù: ${msg}`);
            alert("Message Sent!");
        }

        /* --- News Logic --- */
        function renderNews() {
            const container = document.getElementById(`news-container-${currentServer}`);
            if(container) {
                const filteredNews = newsData.filter(n => n.server === currentServer);
                if(filteredNews.length === 0) container.innerHTML = `<p style="color:var(--text-dim); text-align:center; width:100%; grid-column: 1/-1;">No news available for this region yet.</p>`;
                else {
                    container.innerHTML = filteredNews.map(n => `
                        <div class="news-card" onclick="openNewsDetail('${n.id}')">
                            <img src="${n.img}" class="news-img">
                            <div class="news-info">
                                <div class="news-meta">
                                    <span><i class="far fa-calendar-alt"></i> ${n.date}</span>
                                </div>
                                <h3>${n.title}</h3>
                                <p>${n.desc}</p>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function getYoutubeEmbed(url) {
            if(!url) return null;
            let videoId = "";
            if(url.includes("v=")) videoId = url.split("v=")[1].split("&")[0];
            else if(url.includes("youtu.be/")) videoId = url.split("youtu.be/")[1];
            return videoId ? "https://www.youtube.com/embed/" + videoId : url;
        }

        function openNewsDetail(id) {
            const newsItem = newsData.find(n => n.id === id);
            if(newsItem) {
                // Change URL to ?type=news&id=...
                const newUrl = `?type=news&id=${id}&title=${createSlug(newsItem.title)}`;
                window.history.pushState({path: newUrl}, '', newUrl);
                document.title = `${newsItem.title} | Otaku Universe`;
                renderNewsDetail(newsItem);
            }
        }

        function renderNewsDetail(newsItem) {
            document.getElementById(`news-container-${currentServer}`).style.display = 'none';
            const readerBody = document.getElementById(`reader-body-${currentServer}`);
            
            let contentHtml = `<h1>${newsItem.title}</h1>`;
            if(newsItem.videoUrl) contentHtml += `<div class="video-container"><iframe src="${getYoutubeEmbed(newsItem.videoUrl)}" allowfullscreen></iframe></div>`;
            else contentHtml += `<img src="${newsItem.img}" class="post-image">`;
            
            contentHtml += `<p style="white-space: pre-wrap; line-height: 1.8; color: var(--text-dim); font-size:16px">${newsItem.desc}</p>`;
            readerBody.innerHTML = contentHtml;
            document.getElementById(`news-reader-${currentServer}`).style.display = 'block';
            window.scrollTo(0,0);
        }

        function closeNewsReader() {
            const reader = document.getElementById(`news-reader-${currentServer}`);
            const grid = document.getElementById(`news-container-${currentServer}`);
            if(reader && grid) { reader.style.display = 'none'; grid.style.display = 'grid'; }
        }

        /* --- Reviews Logic --- */
        function renderReviews() {
            const container = document.getElementById('review-grid');
            document.getElementById('review-server-label').innerText = currentServer.toUpperCase();
            
            if(container) {
                const filteredReviews = reviewsData.filter(r => r.server === currentServer);
                if(filteredReviews.length === 0) container.innerHTML = `<p style="color:var(--text-dim); text-align:center; grid-column: 1/-1;">No reviews yet.</p>`;
                else {
                    container.innerHTML = filteredReviews.map(r => `
                        <div class="news-card" onclick="openReviewDetail('${r.id}')">
                             <div class="review-score-badge"><i class="fas fa-star"></i> ${r.score}</div>
                            <img src="${r.img}" class="news-img">
                            <div class="news-info">
                                <h3>${r.title}</h3>
                                <p>${r.desc}</p>
                            </div>
                        </div>
                    `).join('');
                }
            }
        }

        function openReviewDetail(id) {
            const item = reviewsData.find(r => r.id === id);
            if(item) {
                const newUrl = `?type=review&id=${id}&title=${createSlug(item.title)}`;
                window.history.pushState({path: newUrl}, '', newUrl);
                document.title = `${item.title} | Review`;
                renderReviewDetail(item);
            }
        }

        function renderReviewDetail(item) {
            document.getElementById('review-grid').style.display = 'none';
            const body = document.getElementById('review-body');
            body.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <h1>${item.title}</h1>
                    <div style="background:var(--review-color); color:black; font-weight:bold; padding:8px 20px; border-radius:12px; font-size:20px; box-shadow:0 4px 15px rgba(241, 196, 15, 0.4)"><i class="fas fa-star"></i> ${item.score}</div>
                </div>
                <img src="${item.img}" class="post-image">
                <p style="white-space: pre-wrap; line-height: 1.8; color: var(--text-dim); font-size:16px">${item.desc}</p>
            `;
            document.getElementById('review-reader').style.display = 'block';
            window.scrollTo(0,0);
        }

        function closeReviewReader() {
            document.getElementById('review-reader').style.display = 'none';
            document.getElementById('review-grid').style.display = 'grid';
        }

        /* --- Forum Logic --- */
        function renderForum() {
            const feed = document.getElementById('forum-feed');
            document.getElementById('community-server-label').innerText = currentServer.toUpperCase();
            let filtered = threads.filter(t => t.server === currentServer);

            if (filtered.length === 0) {
                feed.innerHTML = `<p style="text-align:center; padding:40px; color:var(--text-dim); background:var(--card-bg); border-radius:20px; border:var(--border)">Be the first to start a discussion in ${currentServer.toUpperCase()}!</p>`;
                return;
            }

            feed.innerHTML = filtered.map(t => `
                <div class="post-card" onclick="openThread('${t.id}')">
                    <h3>${t.title}</h3>
                    <div class="post-meta">
                        <span><i class="fas fa-user-circle"></i> ${t.user}</span>
                        <span><i class="far fa-comments"></i> ${t.comments ? t.comments.length : 0}</span>
                        <span><i class="far fa-heart"></i> ${t.likes || 0}</span>
                    </div>
                </div>
            `).join('');
        }

        function openThread(id) {
            activeThread = threads.find(t => t.id === id);
            activeThreadDocId = id;
            if (!activeThread) return; 

            document.getElementById('forum-main-ui').style.display = 'none';
            document.getElementById('forum-detail-ui').style.display = 'block';
            
            let imgPart = activeThread.img ? `<img src="${activeThread.img}" class="post-image">` : '';
            document.getElementById('thread-content').innerHTML = `<h1>${activeThread.title}</h1>${imgPart}<p style="font-size:16px; color:var(--text-dim); line-height:1.6">${activeThread.desc}</p>`;
            updateReactionUI(); renderComments();
        }

        function closeThread() {
            document.getElementById('forum-main-ui').style.display = 'block';
            document.getElementById('forum-detail-ui').style.display = 'none';
            activeThread = null; activeThreadDocId = null;
        }

        function updateReaction(type) {
            if (!activeThreadDocId) return;
            let updateData = type === 'like' ? { likes: firebase.firestore.FieldValue.increment(1) } : {};
            db.collection('threads').doc(activeThreadDocId).update(updateData);
        }

        function updateReactionUI() {
            if(!activeThread) return;
            document.getElementById('like-total').innerText = activeThread.likes || 0;
        }

        function postComment() {
            if(!currentUser) return openModal('login-modal');
            const text = document.getElementById('comment-text').value;
            if(!text) return;
            
            sendTextToTelegram(`üí¨ Forum Comment:\nüìå Topic: ${activeThread.title}\nüë§ User: ${currentUser.name}\nüìù: ${text}`);

            db.collection('threads').doc(activeThreadDocId).update({
                comments: firebase.firestore.FieldValue.arrayUnion({ id: Date.now(), user: currentUser.name, avatar: currentUser.avatar, text: text })
            }).then(() => { document.getElementById('comment-text').value = ''; });
        }

        function renderComments() {
            const box = document.getElementById('comments-render');
            const comments = activeThread.comments || [];
            if(comments.length === 0) box.innerHTML = '<p style="color:var(--text-dim)">No comments yet. Be the first!</p>';
            else {
                box.innerHTML = comments.map(c => `
                    <div class="comment-item">
                        <img src="${c.avatar}">
                        <div class="comment-data">
                            <h4>${c.user}</h4>
                            <p>${c.text}</p>
                        </div>
                    </div>
                `).join('');
            }
        }

        function reportCurrentThread() { if(activeThread) openReportModal(activeThread.user, activeThread.title); }

        function openReportModal(user, text) {
            document.getElementById('report-target-user').value = user;
            document.getElementById('report-target-text').value = text;
            openModal('report-modal');
        }

        function submitReport() {
            const reason = document.getElementById('report-reason').value;
            const rUser = document.getElementById('report-target-user').value;
            const rText = document.getElementById('report-target-text').value;
            sendTextToTelegram(`üö® REPORT [${currentServer}]:\nReason: ${reason}\nUser: ${rUser}\nContent: "${rText}"`);
            alert("Report submitted! We will review it shortly."); closeAllModals();
        }

        async function saveThread() {
            if(!currentUser) return openModal('login-modal');
            const title = document.getElementById('p-title').value;
            const desc = document.getElementById('p-desc').value;
            const imgUrl = document.getElementById('p-img-url').value; 
            
            if(!title || !desc) return;
            sendTextToTelegram(`üì¢ New Thread (${currentServer}):\nüë§: ${currentUser.name}\nüìå: ${title}`);
            db.collection('threads').add({ 
                user: currentUser.name, title, desc, img: imgUrl || "", likes: 0, 
                comments: [], server: currentServer, createdAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => { closeAllModals(); });
        }

        function sendTextToTelegram(message) {
            const url = `https://api.telegram.org/bot${TG_TOKEN}/sendMessage?chat_id=${TG_CHANNEL_ID}&text=${encodeURIComponent(message)}`;
            fetch(url).catch(err => console.error("Err:", err));
        }

        function openModal(id) { closeAllModals(); document.getElementById(id).style.display = 'flex'; }
        function closeAllModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.style.display = 'none'); }
    </script>
</body>
</html>
